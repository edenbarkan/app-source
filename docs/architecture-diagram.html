<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App-Source Repository - Application & CI/CD</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 40px;
            font-size: 1.2em;
        }

        .repo-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .repo-info h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .repo-info p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        /* Directory Structure */
        .directory-structure {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 6px solid #4caf50;
        }

        .dir-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tree {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 25px;
            border-radius: 10px;
            font-size: 0.95em;
            line-height: 1.8;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .tree-line {
            color: #2c3e50;
        }

        .tree-folder {
            color: #3498db;
            font-weight: bold;
        }

        .tree-file {
            color: #27ae60;
        }

        .tree-icon {
            color: #e74c3c;
        }

        /* Application Stack */
        .app-stack {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 6px solid #2196f3;
        }

        .stack-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stack-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
            transition: all 0.3s ease;
        }

        .stack-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }

        .stack-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .stack-title {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .stack-desc {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        /* Endpoints */
        .endpoints-section {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 6px solid #ff9800;
        }

        .endpoints-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .endpoints-table th {
            background: #ff9800;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        .endpoints-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
            color: #2c3e50;
        }

        .endpoints-table tr:hover {
            background: #fff3e0;
        }

        .endpoint-method {
            background: #4caf50;
            color: white;
            padding: 4px 10px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.85em;
        }

        /* Docker Build */
        .docker-section {
            background: linear-gradient(135deg, #e1f5fe 0%, #b3e5fc 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 6px solid #03a9f4;
        }

        .docker-stages {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .docker-stage {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-width: 250px;
            text-align: center;
        }

        .stage-number {
            background: #03a9f4;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .stage-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stage-desc {
            color: #7f8c8d;
            font-size: 0.85em;
        }

        .arrow-stage {
            font-size: 2em;
            color: #03a9f4;
        }

        /* CI/CD Pipeline */
        .cicd-pipeline {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 6px solid #9c27b0;
        }

        .pipeline-flow {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .pipeline-step {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .pipeline-number {
            background: #9c27b0;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5em;
            flex-shrink: 0;
        }

        .pipeline-content {
            flex: 1;
        }

        .pipeline-content h5 {
            color: #2c3e50;
            font-size: 1.2em;
            margin-bottom: 8px;
        }

        .pipeline-content p {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .pipeline-content code {
            background: #ecf0f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }

        /* Workflows */
        .workflows-section {
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 6px solid #fbc02d;
        }

        .workflow-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .workflow-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .workflow-card h4 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .workflow-card .trigger {
            background: #4caf50;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.85em;
            margin-bottom: 15px;
            display: inline-block;
        }

        .workflow-card .manual {
            background: #ff9800;
        }

        .workflow-steps {
            list-style: none;
            padding: 0;
        }

        .workflow-steps li {
            padding: 8px 0;
            color: #34495e;
            font-size: 0.9em;
            padding-left: 20px;
            position: relative;
        }

        .workflow-steps li:before {
            content: "‚ñ∏";
            position: absolute;
            left: 0;
            color: #3498db;
            font-weight: bold;
        }

        /* GitHub Secrets */
        .secrets-section {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 6px solid #e74c3c;
        }

        .secrets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .secret-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .secret-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1em;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
            background: #ecf0f1;
            padding: 8px;
            border-radius: 5px;
        }

        .secret-desc {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        /* Code Block */
        .code-block {
            background: #263238;
            color: #aed581;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            font-size: 0.9em;
            line-height: 1.6;
        }

        .code-block .comment {
            color: #78909c;
        }

        .code-block .command {
            color: #4fc3f7;
        }

        /* Image Tagging */
        .tagging-section {
            background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 6px solid #009688;
        }

        .tagging-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tagging-table th {
            background: #009688;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        .tagging-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
            color: #2c3e50;
        }

        .tagging-table tr:hover {
            background: #e0f2f1;
        }

        /* Security Features */
        .security-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card h4 {
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .feature-card ul {
            list-style: none;
            padding: 0;
        }

        .feature-card li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
            font-size: 0.9em;
        }

        .feature-card li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
        }

        @media (max-width: 768px) {
            .docker-stages {
                flex-direction: column;
            }

            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± app-source Repository</h1>
        <p class="subtitle">Application Code & CI/CD Pipelines</p>

        <div class="repo-info">
            <h2>üì¶ Repository Purpose</h2>
            <p>Contains the Express.js application code, Dockerfile, and GitHub Actions CI/CD workflows for building, testing, and promoting application images across environments</p>
        </div>

        <!-- Directory Structure -->
        <div class="directory-structure">
            <div class="dir-title">üìÅ Repository Structure</div>
            <div class="tree">
<pre class="tree-line">app-source/
‚îú‚îÄ‚îÄ <span class="tree-icon">üìÑ</span> <span class="tree-file">README.md</span>                     # Documentation
‚îú‚îÄ‚îÄ <span class="tree-icon">üê≥</span> <span class="tree-file">Dockerfile</span>                     # Multi-stage build
‚îú‚îÄ‚îÄ <span class="tree-icon">üìù</span> <span class="tree-file">.dockerignore</span>                 # Docker ignore rules
‚îÇ
‚îú‚îÄ‚îÄ <span class="tree-folder">üìÇ src/</span>                            # <strong>Application Source Code</strong>
‚îÇ   ‚îú‚îÄ‚îÄ <span class="tree-file">index.js</span>                      # Express.js application
‚îÇ   ‚îî‚îÄ‚îÄ <span class="tree-file">package.json</span>                  # Node.js dependencies
‚îÇ       ‚îî‚îÄ‚îÄ Dependencies:
‚îÇ           ‚îî‚îÄ‚îÄ express: ^4.18.2
‚îÇ
‚îî‚îÄ‚îÄ <span class="tree-folder">‚öôÔ∏è  .github/</span>                        # <strong>GitHub Actions Workflows</strong>
    ‚îî‚îÄ‚îÄ <span class="tree-folder">workflows/</span>
        ‚îú‚îÄ‚îÄ <span class="tree-file">ci.yaml</span>                   # <strong>Main CI Pipeline</strong>
        ‚îÇ   ‚îî‚îÄ‚îÄ Trigger: push to 'develop' branch
        ‚îÇ   ‚îî‚îÄ‚îÄ Steps:
        ‚îÇ       ‚îú‚îÄ‚îÄ 1. Checkout code
        ‚îÇ       ‚îú‚îÄ‚îÄ 2. npm install & test
        ‚îÇ       ‚îú‚îÄ‚îÄ 3. Docker build (multi-stage)
        ‚îÇ       ‚îú‚îÄ‚îÄ 4. Trivy security scan
        ‚îÇ       ‚îú‚îÄ‚îÄ 5. Push to ECR (via OIDC)
        ‚îÇ       ‚îî‚îÄ‚îÄ 6. Update helm-charts repo (dev overlay)
        ‚îÇ
        ‚îú‚îÄ‚îÄ <span class="tree-file">promote-staging.yaml</span>       # <strong>Staging Promotion</strong>
        ‚îÇ   ‚îî‚îÄ‚îÄ Trigger: workflow_dispatch (manual)
        ‚îÇ   ‚îî‚îÄ‚îÄ Input: image_tag (e.g., sha-abc1234)
        ‚îÇ   ‚îî‚îÄ‚îÄ Updates: helm-charts staging overlay
        ‚îÇ
        ‚îî‚îÄ‚îÄ <span class="tree-file">promote-production.yaml</span>    # <strong>Production Promotion</strong>
            ‚îî‚îÄ‚îÄ Trigger: workflow_dispatch (manual)
            ‚îî‚îÄ‚îÄ Input: semantic_version (e.g., v1.0.0)
            ‚îî‚îÄ‚îÄ Steps:
                ‚îú‚îÄ‚îÄ 1. Tag ECR image with version
                ‚îî‚îÄ‚îÄ 2. Update helm-charts prod overlay</pre>
            </div>
        </div>

        <!-- Application Stack -->
        <div class="app-stack">
            <div class="dir-title">üèóÔ∏è Application Stack</div>
            <div class="stack-grid">
                <div class="stack-card">
                    <div class="stack-icon">üü¢</div>
                    <div class="stack-title">Node.js 18</div>
                    <div class="stack-desc">JavaScript runtime on Alpine Linux for minimal image size</div>
                </div>

                <div class="stack-card">
                    <div class="stack-icon">üöÄ</div>
                    <div class="stack-title">Express.js</div>
                    <div class="stack-desc">Fast, minimalist web framework for Node.js REST APIs</div>
                </div>

                <div class="stack-card">
                    <div class="stack-icon">üê≥</div>
                    <div class="stack-title">Docker</div>
                    <div class="stack-desc">Multi-stage build for optimized production images</div>
                </div>

                <div class="stack-card">
                    <div class="stack-icon">‚öôÔ∏è</div>
                    <div class="stack-title">GitHub Actions</div>
                    <div class="stack-desc">CI/CD automation with OIDC authentication to AWS</div>
                </div>

                <div class="stack-card">
                    <div class="stack-icon">üì¶</div>
                    <div class="stack-title">Amazon ECR</div>
                    <div class="stack-desc">Container registry for storing Docker images</div>
                </div>

                <div class="stack-card">
                    <div class="stack-icon">üîÑ</div>
                    <div class="stack-title">ArgoCD</div>
                    <div class="stack-desc">GitOps deployment to Kubernetes clusters</div>
                </div>
            </div>
        </div>

        <!-- API Endpoints -->
        <div class="endpoints-section">
            <div class="dir-title">üåê Application API Endpoints</div>
            <table class="endpoints-table">
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Endpoint</th>
                        <th>Purpose</th>
                        <th>Response</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="endpoint-method">GET</span></td>
                        <td><code>/</code></td>
                        <td>Main application endpoint</td>
                        <td><code>{"version": "1.0.0", "environment": "dev"}</code></td>
                    </tr>
                    <tr>
                        <td><span class="endpoint-method">GET</span></td>
                        <td><code>/health</code></td>
                        <td>Liveness probe (container health)</td>
                        <td><code>{"status": "healthy"}</code></td>
                    </tr>
                    <tr>
                        <td><span class="endpoint-method">GET</span></td>
                        <td><code>/ready</code></td>
                        <td>Readiness probe (can accept traffic)</td>
                        <td><code>{"status": "ready"}</code></td>
                    </tr>
                </tbody>
            </table>
            <div class="code-block" style="margin-top: 20px;">
<span class="comment"># Test locally</span>
<span class="command">cd src && npm install && npm start</span>

<span class="comment"># Test endpoints</span>
<span class="command">curl http://localhost:8080/</span>
<span class="command">curl http://localhost:8080/health</span>
<span class="command">curl http://localhost:8080/ready</span>
            </div>
        </div>

        <!-- Docker Multi-Stage Build -->
        <div class="docker-section">
            <div class="dir-title">üê≥ Docker Multi-Stage Build</div>
            <p style="color: #2c3e50; margin-bottom: 20px;">Multi-stage builds create smaller, more secure images by separating build dependencies from the runtime environment.</p>

            <div class="docker-stages">
                <div class="docker-stage">
                    <div class="stage-number">1</div>
                    <div class="stage-title">Builder Stage</div>
                    <div class="stage-desc">
                        <strong>Base:</strong> node:18-alpine<br/>
                        <strong>Purpose:</strong> Install dependencies<br/>
                        <strong>Command:</strong> npm ci --only=production
                    </div>
                </div>

                <span class="arrow-stage">‚Üí</span>

                <div class="docker-stage">
                    <div class="stage-number">2</div>
                    <div class="stage-title">Runtime Stage</div>
                    <div class="stage-desc">
                        <strong>Base:</strong> node:18-alpine<br/>
                        <strong>Copy:</strong> Only node_modules + src<br/>
                        <strong>User:</strong> Non-root (UID 1000)<br/>
                        <strong>Port:</strong> 8080
                    </div>
                </div>

                <span class="arrow-stage">‚Üí</span>

                <div class="docker-stage">
                    <div class="stage-number">3</div>
                    <div class="stage-title">Final Image</div>
                    <div class="stage-desc">
                        <strong>Size:</strong> ~100MB (vs ~500MB without multi-stage)<br/>
                        <strong>Security:</strong> No build tools<br/>
                        <strong>Health:</strong> Built-in healthcheck
                    </div>
                </div>
            </div>

            <div class="security-features">
                <div class="feature-card">
                    <h4>üîí Security Features</h4>
                    <ul>
                        <li>Non-root user (UID 1000)</li>
                        <li>Alpine Linux base (minimal attack surface)</li>
                        <li>No build tools in final image</li>
                        <li>Production dependencies only</li>
                        <li>Trivy vulnerability scanning</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4>‚ö° Optimization</h4>
                    <ul>
                        <li>Multi-stage build (smaller images)</li>
                        <li>Layer caching for faster builds</li>
                        <li>Alpine base (~5MB vs ~100MB)</li>
                        <li>.dockerignore to exclude files</li>
                        <li>Built-in health checks</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- CI/CD Pipeline -->
        <div class="cicd-pipeline">
            <div class="dir-title">üîÑ CI/CD Pipeline (ci.yaml)</div>
            <p style="color: #2c3e50; margin-bottom: 20px;">Automatic pipeline triggered on every push to the <code>develop</code> branch</p>

            <div class="pipeline-flow">
                <div class="pipeline-step">
                    <div class="pipeline-number">1</div>
                    <div class="pipeline-content">
                        <h5>Checkout Code</h5>
                        <p>Clone repository using <code>actions/checkout@v3</code></p>
                    </div>
                </div>

                <div class="pipeline-step">
                    <div class="pipeline-number">2</div>
                    <div class="pipeline-content">
                        <h5>Install Dependencies & Test</h5>
                        <p>Run <code>npm install</code> and <code>npm test</code> to verify code quality</p>
                    </div>
                </div>

                <div class="pipeline-step">
                    <div class="pipeline-number">3</div>
                    <div class="pipeline-content">
                        <h5>Configure AWS Credentials (OIDC)</h5>
                        <p>Authenticate to AWS using OIDC (no long-lived credentials!)<br/>Assumes IAM role: <code>github-actions-role</code></p>
                    </div>
                </div>

                <div class="pipeline-step">
                    <div class="pipeline-number">4</div>
                    <div class="pipeline-content">
                        <h5>Build Docker Image</h5>
                        <p>Multi-stage build: <code>docker build -t myapp:sha-$SHORT_SHA .</code><br/>Tag format: <code>sha-abc1234</code></p>
                    </div>
                </div>

                <div class="pipeline-step">
                    <div class="pipeline-number">5</div>
                    <div class="pipeline-content">
                        <h5>Security Scan (Trivy)</h5>
                        <p>Scan image for vulnerabilities: HIGH and CRITICAL severities<br/>Fails pipeline if vulnerabilities found</p>
                    </div>
                </div>

                <div class="pipeline-step">
                    <div class="pipeline-number">6</div>
                    <div class="pipeline-content">
                        <h5>Push to ECR</h5>
                        <p>Push image to Amazon ECR: <code>123456789012.dkr.ecr.us-east-1.amazonaws.com/myapp:sha-abc1234</code></p>
                    </div>
                </div>

                <div class="pipeline-step">
                    <div class="pipeline-number">7</div>
                    <div class="pipeline-content">
                        <h5>Update helm-charts Repository</h5>
                        <p>Clone helm-charts repo using <code>GH_PAT</code><br/>Update <code>apps/myapp/overlays/dev/values.yaml</code> with new image tag<br/>Commit and push changes</p>
                    </div>
                </div>

                <div class="pipeline-step">
                    <div class="pipeline-number">8</div>
                    <div class="pipeline-content">
                        <h5>ArgoCD Auto-Deploys</h5>
                        <p>ArgoCD detects Git change and auto-syncs to dev namespace<br/>Kubernetes performs rolling update (zero downtime)</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Workflows -->
        <div class="workflows-section">
            <div class="dir-title">‚öôÔ∏è GitHub Actions Workflows</div>
            <div class="workflow-grid">
                <div class="workflow-card">
                    <h4>üîÑ CI Pipeline (ci.yaml)</h4>
                    <div class="trigger">Automatic: push to 'develop'</div>
                    <ul class="workflow-steps">
                        <li>Runs on every commit to develop branch</li>
                        <li>Builds, tests, scans, and pushes image</li>
                        <li>Tags image with git SHA (sha-abc1234)</li>
                        <li>Updates dev environment automatically</li>
                        <li>ArgoCD auto-syncs within 3 minutes</li>
                    </ul>
                </div>

                <div class="workflow-card">
                    <h4>üéØ Staging Promotion</h4>
                    <div class="trigger manual">Manual: workflow_dispatch</div>
                    <ul class="workflow-steps">
                        <li>Input: image_tag (e.g., sha-abc1234)</li>
                        <li>No rebuild - uses existing ECR image</li>
                        <li>Updates staging overlay in helm-charts</li>
                        <li>ArgoCD auto-syncs to staging namespace</li>
                        <li>Allows testing before production</li>
                    </ul>
                </div>

                <div class="workflow-card">
                    <h4>üè≠ Production Promotion</h4>
                    <div class="trigger manual">Manual: workflow_dispatch</div>
                    <ul class="workflow-steps">
                        <li>Input: semantic_version (e.g., v1.0.0)</li>
                        <li>Tags existing ECR image with version</li>
                        <li>Updates production overlay</li>
                        <li>ArgoCD shows OutOfSync (manual sync required)</li>
                        <li>Admin manually syncs in ArgoCD UI</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- GitHub Secrets -->
        <div class="secrets-section">
            <div class="dir-title">üîê Required GitHub Secrets</div>
            <p style="color: #2c3e50; margin-bottom: 20px;">Configure these secrets in your GitHub repository settings ‚Üí Secrets and variables ‚Üí Actions</p>

            <div class="secrets-grid">
                <div class="secret-card">
                    <div class="secret-name">AWS_ACCOUNT_ID</div>
                    <div class="secret-desc">
                        <strong>Value:</strong> Your AWS account ID (e.g., 123456789012)<br/>
                        <strong>Used for:</strong> ECR registry URL construction<br/>
                        <strong>Example:</strong> <code>123456789012.dkr.ecr.us-east-1.amazonaws.com</code>
                    </div>
                </div>

                <div class="secret-card">
                    <div class="secret-name">GH_PAT</div>
                    <div class="secret-desc">
                        <strong>Value:</strong> GitHub Personal Access Token (classic)<br/>
                        <strong>Scopes:</strong> <code>repo</code> (full control of private repos)<br/>
                        <strong>Used for:</strong> Cloning and updating helm-charts repo<br/>
                        <strong>Format:</strong> <code>ghp_xxxxxxxxxxxxx</code>
                    </div>
                </div>
            </div>

            <div class="code-block">
<span class="comment"># Create GitHub PAT:</span>
<span class="comment"># 1. Go to GitHub Settings ‚Üí Developer settings</span>
<span class="comment"># 2. Personal access tokens ‚Üí Tokens (classic)</span>
<span class="comment"># 3. Generate new token (classic)</span>
<span class="comment"># 4. Select 'repo' scope</span>
<span class="comment"># 5. Copy token and add to repository secrets</span>
            </div>
        </div>

        <!-- Image Tagging Strategy -->
        <div class="tagging-section">
            <div class="dir-title">üè∑Ô∏è Image Tagging Strategy</div>
            <table class="tagging-table">
                <thead>
                    <tr>
                        <th>Environment</th>
                        <th>Tag Format</th>
                        <th>Example</th>
                        <th>Updated By</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Dev</strong></td>
                        <td><code>sha-{commit}</code></td>
                        <td><code>sha-a1b2c3d</code></td>
                        <td>CI (automatic)</td>
                        <td>Fast iteration, tied to git commit</td>
                    </tr>
                    <tr>
                        <td><strong>Staging</strong></td>
                        <td><code>sha-{commit}</code></td>
                        <td><code>sha-a1b2c3d</code></td>
                        <td>Manual promotion</td>
                        <td>Test exact image before prod</td>
                    </tr>
                    <tr>
                        <td><strong>Production</strong></td>
                        <td><code>v{semver}</code></td>
                        <td><code>v1.0.0</code></td>
                        <td>Manual promotion</td>
                        <td>Semantic versioning for releases</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- AWS OIDC Setup -->
        <div class="app-stack">
            <div class="dir-title">üîë AWS OIDC Setup (No Long-Lived Credentials)</div>
            <p style="color: #2c3e50; margin-bottom: 20px;">GitHub Actions authenticates to AWS using OIDC (OpenID Connect), eliminating the need for AWS access keys stored in GitHub Secrets.</p>

            <div class="code-block">
<span class="comment"># 1. Create OIDC provider in AWS IAM</span>
<span class="command">aws iam create-open-id-connect-provider \</span>
  --url https://token.actions.githubusercontent.com \
  --client-id-list sts.amazonaws.com \
  --thumbprint-list 6938fd4d98bab03faadb97b34396831e3780aea1

<span class="comment"># 2. Create trust policy (replace ACCOUNT_ID and username)</span>
cat > github-trust-policy.json <<'EOF'
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Allow",
    "Principal": {
      "Federated": "arn:aws:iam::ACCOUNT_ID:oidc-provider/token.actions.githubusercontent.com"
    },
    "Action": "sts:AssumeRoleWithWebIdentity",
    "Condition": {
      "StringEquals": {
        "token.actions.githubusercontent.com:aud": "sts.amazonaws.com"
      },
      "StringLike": {
        "token.actions.githubusercontent.com:sub": "repo:username/*:*"
      }
    }
  }]
}
EOF

<span class="comment"># 3. Create IAM role</span>
<span class="command">aws iam create-role \</span>
  --role-name github-actions-role \
  --assume-role-policy-document file://github-trust-policy.json

<span class="comment"># 4. Attach ECR permissions</span>
<span class="command">aws iam attach-role-policy \</span>
  --role-name github-actions-role \
  --policy-arn arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryPowerUser
            </div>
        </div>

        <!-- Key Features -->
        <div class="app-stack" style="margin-top: 30px;">
            <div class="dir-title">‚ú® Key Features & Best Practices</div>
            <div class="security-features">
                <div class="feature-card">
                    <h4>üîê Security</h4>
                    <ul>
                        <li>OIDC authentication (no AWS keys)</li>
                        <li>Trivy vulnerability scanning</li>
                        <li>Non-root container user</li>
                        <li>Multi-stage builds (no build tools)</li>
                        <li>Alpine base (minimal attack surface)</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4>üöÄ CI/CD</h4>
                    <ul>
                        <li>Automated dev deployments</li>
                        <li>Manual staging promotion</li>
                        <li>Manual production approval</li>
                        <li>GitOps with ArgoCD</li>
                        <li>Zero-downtime rolling updates</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4>üì¶ Image Management</h4>
                    <ul>
                        <li>SHA-based tags for dev/staging</li>
                        <li>Semantic versioning for prod</li>
                        <li>ECR lifecycle policies</li>
                        <li>Image scanning on push</li>
                        <li>Multi-stage optimization</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4>üéØ Developer Experience</h4>
                    <ul>
                        <li>Fast feedback loops</li>
                        <li>Local development support</li>
                        <li>Health check endpoints</li>
                        <li>Clear promotion workflow</li>
                        <li>Audit trail in Git</li>
                    </ul>
                </div>
            </div>
        </div>

    </div>
</body>
</html>