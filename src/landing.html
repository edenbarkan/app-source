<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyApp on EKS</title>
    <style>
        :root {
            --color-primary: #667eea;
            --color-secondary: #764ba2;
            --color-success: #48bb78;
            --color-danger: #f56565;
            --color-text: #2d3748;
            --color-muted: #718096;
            --color-light: #e2e8f0;
            --color-bg: #f7fafc;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --radius: 12px;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-family);
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--color-text);
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        /* Hero */
        header {
            text-align: center;
            margin-bottom: 36px;
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--color-muted);
            font-size: 1.1em;
            margin-bottom: 14px;
        }

        .badges {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-env {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: white;
        }

        .badge-version {
            background: var(--color-bg);
            color: var(--color-text);
            border: 1px solid var(--color-light);
        }

        .badge-live {
            background: rgba(72, 187, 120, 0.1);
            color: var(--color-success);
            border: 1px solid var(--color-success);
        }

        .pulse {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(72, 187, 120, 0.4); }
            50% { opacity: 0.8; box-shadow: 0 0 0 8px rgba(72, 187, 120, 0); }
        }

        /* Sections */
        section { margin-bottom: 36px; }

        h2 {
            font-size: 1.4em;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--color-light);
        }

        h2 span { margin-right: 8px; }

        /* Status Cards */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 14px;
        }

        .status-card {
            background: var(--color-bg);
            border-radius: var(--radius);
            padding: 18px;
            text-align: center;
            border: 1px solid var(--color-light);
            transition: var(--transition);
        }

        .status-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .status-card .label {
            font-size: 0.75em;
            color: var(--color-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .status-card .value {
            font-size: 1.1em;
            font-weight: 700;
            word-break: break-all;
        }

        .status-ok { color: var(--color-success); }
        .status-err { color: var(--color-danger); }
        .status-info { color: var(--color-primary); }

        .refresh-info {
            text-align: right;
            font-size: 0.72em;
            color: var(--color-muted);
            margin-top: 6px;
        }

        /* How It Works â€” 3 columns */
        .columns {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .column {
            background: var(--color-bg);
            border-radius: var(--radius);
            padding: 20px;
            border-top: 3px solid var(--color-primary);
        }

        .column:nth-child(2) { border-top-color: var(--color-success); }
        .column:nth-child(3) { border-top-color: #ed8936; }

        .column h3 {
            font-size: 0.95em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .column ul {
            list-style: none;
            padding: 0;
        }

        .column li {
            font-size: 0.82em;
            color: var(--color-muted);
            padding: 4px 0;
            line-height: 1.4;
        }

        .column li::before {
            content: "\2022";
            color: var(--color-primary);
            font-weight: bold;
            margin-right: 6px;
        }

        .column:nth-child(2) li::before { color: var(--color-success); }
        .column:nth-child(3) li::before { color: #ed8936; }

        /* Footer */
        footer {
            text-align: center;
            padding-top: 24px;
            border-top: 2px solid var(--color-light);
        }

        .tech-pills {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .pill {
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.75em;
            font-weight: 600;
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: white;
        }

        footer p {
            color: var(--color-muted);
            font-size: 0.8em;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 20px; }
            h1 { font-size: 1.8em; }
            .status-grid { grid-template-columns: repeat(2, 1fr); }
            .columns { grid-template-columns: 1fr; }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">

        <!-- Hero -->
        <header>
            <h1>MyApp on EKS</h1>
            <p class="subtitle">Production-Grade Kubernetes Infrastructure</p>
            <div class="badges">
                <span class="badge badge-env"><!--SERVER:ENVIRONMENT--></span>
                <span class="badge badge-version"><!--SERVER:VERSION--></span>
                <span class="badge badge-live"><span class="pulse" aria-hidden="true"></span> Live</span>
            </div>
        </header>

        <main>

            <!-- Live Status -->
            <section aria-label="Live application status">
                <h2><span aria-hidden="true">&#9889;</span> Live Status</h2>
                <div class="status-grid" aria-live="polite">
                    <div class="status-card">
                        <div class="label">Environment</div>
                        <div class="value status-info" id="status-env">loading...</div>
                    </div>
                    <div class="status-card">
                        <div class="label">Database Secret</div>
                        <div class="value" id="status-db">loading...</div>
                    </div>
                    <div class="status-card">
                        <div class="label">API Key Secret</div>
                        <div class="value" id="status-apikey">loading...</div>
                    </div>
                    <div class="status-card">
                        <div class="label">Pod Hostname</div>
                        <div class="value status-info" id="status-hostname" style="font-size:0.8em">loading...</div>
                    </div>
                </div>
                <div class="refresh-info">Auto-refreshes every 30s &middot; Last: <span id="last-refresh">--</span></div>
            </section>

            <!-- How It Works -->
            <section aria-label="How it works">
                <h2><span aria-hidden="true">&#9881;</span> How It Works</h2>
                <div class="columns">
                    <div class="column">
                        <h3>Infrastructure</h3>
                        <ul>
                            <li>EKS 1.32 with Terraform/Terragrunt</li>
                            <li>Karpenter for just-in-time Spot nodes</li>
                            <li>ALB + NGINX Ingress for routing</li>
                            <li>2 clusters: dev (dev+staging) &amp; prod</li>
                            <li>Pod Identity for keyless IAM auth</li>
                        </ul>
                    </div>
                    <div class="column">
                        <h3>Delivery</h3>
                        <ul>
                            <li>GitHub Actions CI: lint, test, scan, push</li>
                            <li>Trivy blocks HIGH/CRITICAL CVEs</li>
                            <li>ArgoCD GitOps auto-sync (dev/staging)</li>
                            <li>Manual promotion to production</li>
                            <li>3 repos: infra / charts / app</li>
                        </ul>
                    </div>
                    <div class="column">
                        <h3>Security</h3>
                        <ul>
                            <li>External Secrets from AWS Secrets Manager</li>
                            <li>Non-root, read-only filesystem, drop ALL</li>
                            <li>OIDC federation (no static credentials)</li>
                            <li>Private subnets for all nodes</li>
                            <li>IAM path isolation per environment</li>
                        </ul>
                    </div>
                </div>
            </section>

        </main>

        <!-- Footer with tech pills -->
        <footer>
            <div class="tech-pills">
                <span class="pill">EKS</span>
                <span class="pill">Terraform</span>
                <span class="pill">Terragrunt</span>
                <span class="pill">ArgoCD</span>
                <span class="pill">Karpenter</span>
                <span class="pill">Helm</span>
                <span class="pill">External Secrets</span>
                <span class="pill">Pod Identity</span>
                <span class="pill">NGINX Ingress</span>
                <span class="pill">GitHub Actions</span>
                <span class="pill">Trivy</span>
                <span class="pill">Node.js</span>
            </div>
            <p>Built with Express.js &middot; Deployed via ArgoCD &middot; Running on Amazon EKS</p>
        </footer>

    </div>

    <script>
        function updateStatus(data) {
            var env = document.getElementById('status-env');
            var db = document.getElementById('status-db');
            var apikey = document.getElementById('status-apikey');
            var hostname = document.getElementById('status-hostname');
            var refresh = document.getElementById('last-refresh');

            env.textContent = data.environment;

            db.textContent = data.secrets.database;
            db.className = 'value ' + (data.secrets.database === 'connected' ? 'status-ok' : 'status-err');

            apikey.textContent = data.secrets.apiKey;
            apikey.className = 'value ' + (data.secrets.apiKey === 'configured' ? 'status-ok' : 'status-err');

            hostname.textContent = data.hostname;
            refresh.textContent = new Date().toLocaleTimeString();
        }

        function refreshStatus() {
            fetch('/api/status')
                .then(function(res) { return res.json(); })
                .then(updateStatus)
                .catch(function() {
                    document.getElementById('status-env').textContent = 'unavailable';
                });
        }

        document.addEventListener('DOMContentLoaded', function() {
            refreshStatus();
            setInterval(refreshStatus, 30000);
        });
    </script>
</body>
</html>
